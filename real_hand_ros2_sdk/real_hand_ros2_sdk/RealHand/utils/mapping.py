#---------------------------------------------------------------------------------------------------
# O6 Left
o6_l_min = [0, 0, 0, 0, 0, 0]
o6_l_max = [1.57, 1.54, 1.57, 1.57, 1.57, 1.57]
o6_l_derict = [-1, -1, -1, -1, -1, -1]
# O6 Right
o6_r_min = [0, 0, 0, 0, 0, 0]
o6_r_max = [1.57, 1.57, 1.57, 1.57, 1.57, 1.57]
o6_r_derict = [-1, -1, -1, -1, -1, -1]
#---------------------------------------------------------------------------------------------------
# L7 Left OK
l7_l_min = [0, 0, 0, 0, 0, 0, -0.52]
l7_l_max = [0.44, 1.43, 1.62, 1.62, 1.62, 1.62, 1.01]
l7_l_derict = [-1, -1, -1, -1, -1, -1, -1]
# L7 Right OK (URDF will be updated later!!!)
l7_r_min = [0, -1.43, 0, 0, 0, 0, 0]
l7_r_max = [0.75, 0, 1.62, 1.62, 1.62, 1.62, 1.54]
l7_r_derict = [-1, 0, -1, -1, -1, -1, -1]
#---------------------------------------------------------------------------------------------------
# L10 Left OK
l10_l_min = [0, 0, 0, 0, 0, 0, 0, -0.26, -0.26, -0.52]
l10_l_max = [1.45, 1.43, 1.62, 1.62, 1.62, 1.62, 0.26, 0, 0, 1.01]
l10_l_derict = [-1, -1, -1, -1, -1, -1, 0, -1, -1, -1]
# L10 Right OK
l10_r_min = [0, 0, 0, 0, 0, 0, -0.26, 0, 0, -0.52]
l10_r_max = [0.75, 1.43, 1.62, 1.62, 1.62, 1.62, 0, 0.13, 0.26, 1.01]
l10_r_derict = [-1, -1, -1, -1, -1, -1, -1, 0, 0, -1]
#---------------------------------------------------------------------------------------------------
# L20 Left OK
l20_l_min = [0, 0, 0, 0, 0, -0.297, -0.26, -0.26, -0.26, -0.26, 0.122, 0, 0, 0, 0, 0, 0, 0, 0, 0]
l20_l_max = [0.87, 1.4, 1.4, 1.4, 1.4, 0.683, 0.26, 0.26, 0.26, 0.26, 1.78, 0, 0, 0, 0, 1.29, 1.08, 1.08, 1.08, 1.08]
l20_l_derict = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1]
# L20 Right OK
l20_r_min = [0, 0, 0, 0, 0, -0.297, -0.26, -0.26, -0.26, -0.26, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
l20_r_max = [0.87, 1.4, 1.4, 1.4, 1.4, 0.683, 0.26, 0.26, 0.26, 0.26, 1.78, 0, 0, 0, 0, 1.29, 1.08, 1.08, 1.08, 1.08]
l20_r_derict = [-1, -1, -1, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1]
#---------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------
# G20 Left OK
g20_l_min = [0, 0, 0, 0, 0, -0.297, -0.26, -0.26, -0.26, -0.26, 0.122, 0, 0, 0, 0, 0, 0, 0, 0, 0]
g20_l_max = [0.87, 1.4, 1.4, 1.4, 1.4, 0.683, 0.26, 0.26, 0.26, 0.26, 1.78, 0, 0, 0, 0, 1.29, 1.08, 1.08, 1.08, 1.08]
g20_l_derict = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1]
# G20 Right OK
g20_r_min = [0, 0, 0, 0, 0, -0.297, -0.26, -0.26, -0.26, -0.26, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
g20_r_max = [0.87, 1.4, 1.4, 1.4, 1.4, 0.683, 0.26, 0.26, 0.26, 0.26, 1.78, 0, 0, 0, 0, 1.29, 1.08, 1.08, 1.08, 1.08]
g20_r_derict = [-1, -1, -1, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1]
#---------------------------------------------------------------------------------------------------
# L21 Left OK
l21_l_min = [0, 0, 0, 0, 0, 0, 0, -0.18, -0.18, 0, -0.6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
l21_l_max = [1, 1.57, 1.57, 1.57, 1.57, 1.6, 0.18, 0.18, 0.18, 0.18, 0.6, 0, 0, 0, 0, 1.57, 0, 0, 0, 0, 1.57, 1.57, 1.57, 1.57, 1.57]
l21_l_derict = [-1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1]
# L21 Right OK
l21_r_min = [0, 0, 0, 0, 0, 0, -0.18, -0.18, -0.18, -0.18, -0.6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
l21_r_max = [1, 1.57, 1.57, 1.57, 1.57, 1.6, 0.18, 0.18, 0.18, 0.18, 0.6, 0, 0, 0, 0, 1.57, 0, 0, 0, 0, 1.57, 1.57, 1.57, 1.57, 1.57]
l21_r_derict = [-1, -1, -1, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1]
#---------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------
# L25 Left OK
l25_l_min = [0, 0, 0, 0, 0, 0, -0.26, -0.26, -0.26, -0.26, -0.26, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
l25_l_max = [0.9, 1.57, 1.57, 1.57, 1.57, 1.3, 0.26, 0.26, 0.26, 0.26, 0.61, 0, 0, 0, 0, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]
l25_l_derict = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]
# L25 Right OK
l25_r_min = [0, 0, 0, 0, 0, 0, -0.26, -0.26, -0.26, -0.26, -0.26, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
l25_r_max = [0.9, 1.57, 1.57, 1.57, 1.57, 1.3, 0.26, 0.26, 0.26, 0.26, 0.61, 0, 0, 0, 0, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57, 1.57]
l25_r_derict = [-1, -1, -1, -1, -1, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]
#---------------------------------------------------------------------------------------------------

def range_to_arc_left(left_range, hand_joint):
    """
    Map 0–255 command range to radians for the LEFT hand of a given joint model.
    Skips non-existent DOFs for some hands (e.g., L20/G20 indices 11–14; L21 indices 11–14 and 16–19).
    Direction array (-1 means reversed mapping).
    """
    num = 0
    if hand_joint == "O6":
        num = 6
        l_min = o6_l_min
        l_max = o6_l_max
        l_derict = o6_l_derict
    elif hand_joint == "L7":
        num = 7
        l_min = l7_l_min
        l_max = l7_l_max
        l_derict = l7_l_derict
    elif hand_joint == "L10":
        num = 10
        l_min = l10_l_min
        l_max = l10_l_max
        l_derict = l10_l_derict
    elif hand_joint == "L20":
        num = 20
        l_min = l20_l_min
        l_max = l20_l_max
        l_derict = l20_l_derict
    elif hand_joint == "G20":
        num = 20
        l_min = g20_l_min
        l_max = g20_l_max
        l_derict = g20_l_derict
    elif hand_joint == "L21":
        num = 25
        l_min = l21_l_min
        l_max = l21_l_max
        l_derict = l21_l_derict
    hand_arc = [0] * num
    for i in range(num):
        if hand_joint == "L20" or hand_joint == "G20":
            if 11 <= i <= 14: 
                continue
        if hand_joint == "L21":
            if 11 <= i <= 14: 
                continue
            if 16 <= i <= 19: 
                continue
        val_l = is_within_range(left_range[i], 0, 255)
        if l_derict[i] == -1:
            hand_arc[i] = scale_value(val_l, 0, 255, l_max[i], l_min[i])
        else:
            hand_arc[i] = scale_value(val_l, 0, 255, l_min[i], l_max[i])
    return hand_arc

def range_to_arc_right(right_range, hand_joint):
    """
    Map 0–255 command range to radians for the RIGHT hand of a given joint model.
    Skips non-existent DOFs as needed. Direction array (-1 means reversed mapping).
    """
    num = 0
    if hand_joint == "O6":
        num = 6
        r_min = o6_r_min
        r_max = o6_r_max
        r_derict = o6_r_derict
    elif hand_joint == "L7":
        num = 7
        r_min = l7_r_min
        r_max = l7_r_max
        r_derict = l7_r_derict
    elif hand_joint == "L10":
        num = 10
        r_min = l10_r_min
        r_max = l10_r_max
        r_derict = l10_r_derict
    elif hand_joint == "L20":
        num = 20
        r_min = l20_r_min
        r_max = l20_r_max
        r_derict = l20_r_derict
    elif hand_joint == "G20":
        num = 20
        r_min = g20_r_min
        r_max = g20_r_max
        r_derict = g20_r_derict
    elif hand_joint == "L21":
        num = 25
        r_min = l21_r_min
        r_max = l21_r_max
        r_derict = l21_r_derict
    hand_arc = [0] * num
    for i in range(num):
        if hand_joint == "L20" or hand_joint == "G20":
            if 11 <= i <= 14: 
                continue
        if hand_joint == "L21":
            if 11 <= i <= 14: 
                continue
            if 16 <= i <= 19: 
                continue
        val_r = is_within_range(right_range[i], 0, 255)
        if r_derict[i] == -1:
            hand_arc[i] = scale_value(val_r, 0, 255, r_max[i], r_min[i])
        else:
            hand_arc[i] = scale_value(val_r, 0, 255, r_min[i], r_max[i])
    return hand_arc
        
'''
Legacy version of arc_to_range_left kept for reference.
'''
def arc_to_range_left(hand_arc_l, hand_joint):
    """
    Map radians back to 0–255 command range for the LEFT hand of a given joint model.
    Respects direction flags and skips non-existent DOFs.
    """
    num = 0
    if hand_joint == "O6":
        num = 6
        l_min = o6_l_min
        l_max = o6_l_max
        l_derict = o6_l_derict
    elif hand_joint == "L7":
        num = 7
        l_min = l7_l_min
        l_max = l7_l_max
        l_derict = l7_l_derict
    elif hand_joint == "L10":
        num = 10
        l_min = l10_l_min
        l_max = l10_l_max
        l_derict = l10_l_derict
    elif hand_joint == "L20":
        num = 20
        l_min = l20_l_min
        l_max = l20_l_max
        l_derict = l20_l_derict
    elif hand_joint == "L21":
        num = 25
        l_min = l21_l_min
        l_max = l21_l_max
        l_derict = l21_l_derict
    hand_range = [0] * num
    for i in range(num):
        if hand_joint == "L20":
            if 11 <= i <= 14: 
                continue
        if hand_joint == "L21":
            if 11 <= i <= 14: 
                continue
            if 16 <= i <= 19: 
                continue
        val_l = is_within_range(hand_arc_l[i], l_min[i], l_max[i])
        if l_derict[i] == -1:
            hand_range[i] = scale_value(val_l, l_min[i], l_max[i], 255, 0)
        else:
            hand_range[i] = scale_value(val_l, l_min[i], l_max[i], 0, 255)

    return hand_range

def arc_to_range_right(right_arc, hand_joint):
    """
    Map radians back to 0–255 command range for the RIGHT hand of a given joint model.
    """
    num = 0
    if hand_joint == "O6":
        num = 6
        r_min = o6_r_min
        r_max = o6_r_max
        r_derict = o6_r_derict
    elif hand_joint == "L7":
        num = 7
        r_min = l7_r_min
        r_max = l7_r_max
        r_derict = l7_r_derict
    elif hand_joint == "L10":
        num = 10
        r_min = l10_r_min
        r_max = l10_r_max
        r_derict = l10_r_derict
    elif hand_joint == "L20":
        num = 20
        r_min = l20_r_min
        r_max = l20_r_max
        r_derict = l20_r_derict
    elif hand_joint == "L21":
        num = 25
        r_min = l21_r_min
        r_max = l21_r_max
        r_derict = l21_r_derict
    hand_range = [0] * num
    for i in range(num):
        if hand_joint == "L20":
            if 11 <= i <= 14: 
                continue
        if hand_joint == "L21":
            if 11 <= i <= 14: 
                continue
            if 16 <= i <= 19: 
                continue
        val_r = is_within_range(right_arc[i], r_min[i], r_max[i])
        if r_derict[i] == -1:
            hand_range[i] = scale_value(val_r, r_min[i], r_max[i], 255, 0)
        else:
            hand_range[i] = scale_value(val_r, r_min[i], r_max[i], 0, 255)
    return hand_range

def range_to_arc_right_l20(hand_range_r):
    """Specialized 0–255 → radians mapping for L20 RIGHT hand (skips 11–14)."""
    hand_arc_r = [0] * 20
    for i in range(20):
        if 11 <= i <= 14: 
            continue
        val_r = is_within_range(hand_range_r[i], 0, 255)
        if l20_r_derict[i] == -1:
            hand_arc_r[i] = scale_value(val_r, 0, 255, l20_r_max[i], l20_r_min[i])
        else:
            hand_arc_r[i] = scale_value(val_r, 0, 255, l20_r_min[i], l20_r_max[i])
    return hand_arc_r

def range_to_arc_left_l20(hand_range_l):
    """Specialized 0–255 → radians mapping for L20 LEFT hand (skips 11–14)."""
    hand_arc_l = [0] * 20
    for i in range(20):
        if 11 <= i <= 14: 
            continue
        val_l = is_within_range(hand_range_l[i], 0, 255)
        if l20_l_derict[i] == -1:
            hand_arc_l[i] = scale_value(val_l, 0, 255, l20_l_max[i], l20_l_min[i])
        else:
            hand_arc_l[i] = scale_value(val_l, 0, 255, l20_l_min[i], l20_l_max[i])
    return hand_arc_l

def arc_to_range_right_l20(hand_arc_r):
    """Specialized radians → 0–255 mapping for L20 RIGHT hand (skips 11–14)."""
    hand_range_r = [0] * 20
    for i in range(20):
        if 11 <= i <= 14: 
            continue
        val_r = is_within_range(hand_arc_r[i], l20_r_min[i], l20_r_max[i])
        if l20_r_derict[i] == -1:
            hand_range_r[i] = scale_value(val_r, l20_r_min[i], l20_r_max[i], 255, 0)
        else:
            hand_range_r[i] = scale_value(val_r, l20_r_min[i], l20_r_max[i], 0, 255)
    return hand_range_r

def arc_to_range_left_l20(hand_arc_l):
    """Specialized radians → 0–255 mapping for L20 LEFT hand (skips 11–14)."""
    hand_range_l = [0] * 20
    for i in range(20):
        if 11 <= i <= 14: 
            continue
        val_l = is_within_range(hand_arc_l[i], l20_l_min[i], l20_l_max[i])
        if l20_l_derict[i] == -1:
            hand_range_l[i] = scale_value(val_l, l20_l_min[i], l20_l_max[i], 255, 0)
        else:
            hand_range_l[i] = scale_value(val_l, l20_l_min[i], l20_l_max[i], 0, 255)
    return hand_range_l

def range_to_arc_right_10(hand_range_r):
    """0–255 → radians for L10 RIGHT hand."""
    hand_arc_r = [0] * 10
    for i in range(10):
        val_r = is_within_range(hand_range_r[i], 0, 255)
        if l10_r_derict[i] == -1:
            hand_arc_r[i] = scale_value(val_r, 0, 255, l10_r_max[i], l10_r_min[i])
        else:
            hand_arc_r[i] = scale_value(val_r, 0, 255, l10_r_min[i], l10_r_max[i])
    return hand_arc_r

def range_to_arc_left_10(hand_range_l):
    """0–255 → radians for L10 LEFT hand."""
    hand_arc_l = [0] * 10
    for i in range(10):
        val_l = is_within_range(hand_range_l[i], 0, 255)
        if l10_l_derict[i] == -1:
            hand_arc_l[i] = scale_value(val_l, 0, 255, l10_l_max[i], l10_l_min[i])
        else:
            hand_arc_l[i] = scale_value(val_l, 0, 255, l10_l_min[i], l10_l_max[i])
    return hand_arc_l

def arc_to_range_right_10(hand_arc_r):
    """Radians → 0–255 for L10 RIGHT hand."""
    hand_range_r = [0] * 10
    for i in range(10):
        val_r = is_within_range(hand_arc_r[i], l10_r_min[i], l10_r_max[i])
        if l10_r_derict[i] == -1:
            hand_range_r[i] = scale_value(val_r, l10_r_min[i], l10_r_max[i], 255, 0)
        else:
            hand_range_r[i] = scale_value(val_r, l10_r_min[i], l10_r_max[i], 0, 255)
    return hand_range_r

def arc_to_range_left_10(hand_arc_l):
    """Radians → 0–255 for L10 LEFT hand."""
    hand_range_l = [0] * 10
    for i in range(10):
        val_l = is_within_range(hand_arc_l[i], l10_l_min[i], l10_l_max[i])
        if l10_l_derict[i] == -1:
            hand_range_l[i] = scale_value(val_l, l10_l_min[i], l10_l_max[i], 255, 0)
        else:
            hand_range_l[i] = scale_value(val_l, l10_l_min[i], l10_l_max[i], 0, 255)
    return hand_range_l

def scale_value(original_value, a_min, a_max, b_min, b_max):
    """Linear map from [a_min, a_max] to [b_min, b_max]."""
    return (original_value - a_min) * (b_max - b_min) / (a_max - a_min) + b_min

def is_within_range(value, min_value, max_value):
    """Clamp value to [min_value, max_value]."""
    return min(max_value, max(min_value, value))
